<?xml version="1.0" encoding="UTF-8"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://chartConfigView.title">

    <actions>
        <action id="closeAction" type="view_close"/>
    </actions>

    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>

    <!-- ðŸ”¹ GLOBAL LAYOUT -->
    <layout>

        <!-- ðŸ”¹ HEADER -->
        <vbox width="100%" css="background-color: #ffffff; padding: 12px 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); flex-shrink: 0;">
            <hbox spacing="true" css="gap: 40px; align-items: center;">
                <hbox css="gap: 8px; align-items: center;">
                    <icon icon="DATABASE" css="color: var(--lumo-primary-color); width: 18px; height: 18px;"/>
                    <nativeLabel text="Dataset:" css="font-weight: 600; color: var(--lumo-secondary-text-color); font-size: 0.9em;"/>
                    <nativeLabel id="datasetNameLabel" css="font-weight: 600; color: var(--lumo-header-text-color); font-size: 1.1em;"/>
                </hbox>

                <hbox css="gap: 8px; align-items: center;">
                    <icon icon="BAR_CHART" css="color: var(--lumo-primary-color); width: 18px; height: 18px;"/>
                    <nativeLabel text="Chart type:" css="font-weight: 600; color: var(--lumo-secondary-text-color); font-size: 0.9em;"/>
                    <nativeLabel id="chartTypeLabel" css="font-weight: 600; color: var(--lumo-header-text-color); font-size: 1.1em;"/>
                </hbox>
            </hbox>
        </vbox>

        <!-- ðŸ”¹ TOOLBAR -->
        <hbox width="100%" css="align-items: center; gap: 16px; flex-shrink: 0;">
            <textField id="chartNameField"
                       placeholder="Nháº­p tÃªn biá»ƒu Ä‘á»“..."
                       height="45px"
                       css="flex-grow: 1; font-size: 15px;"
                       helperText="TÃªn hiá»ƒn thá»‹ trÃªn dashboard">
                <prefix>
                    <icon icon="PENCIL" css="width: 18px; height: 18px;"/>
                </prefix>
            </textField>

            <button id="save"
                    text="LÆ°u cáº¥u hÃ¬nh"
                    icon="CHECK"
                    height="45px"
                    themeNames="primary"
                    css="border-radius: 8px; padding: 0 32px; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(var(--lumo-primary-color-rgb), 0.3); flex-shrink: 0;"/>
        </hbox>

        <!-- ðŸ”¹ MAIN CONTENT: SPLIT LAYOUT -->
        <!--
             LÆ¯U Ã: width="100%" height="100%" chá»‰ Ã¡p dá»¥ng cho SPLIT cha.
             CÃ¡c VBOX con KHÃ”NG ÄÆ¯á»¢C set width="100%" náº¿u cÃ³ margin.
        -->

        <!-- OUTER SPLIT: Chia (TrÃ¡i+Giá»¯a) 40% | (Pháº£i) 60% -->
        <split id="mainSplit" width="100%" height="100%" orientation="HORIZONTAL" splitterPosition="40" themeNames="small">

            <!-- ðŸŸ§ VÃ™NG BÃŠN TRÃI (Chá»©a Fields + Config) -->
            <!-- INNER SPLIT: Chia Fields 45% | Config 55% -->
            <split id="innerSplit" width="100%" height="100%" orientation="HORIZONTAL" splitterPosition="45" themeNames="small">

                <!-- ðŸ”¸ Cá»˜T 1: Fields List -->
                <!-- ÄÃ£ xÃ³a width="100%", giá»¯ height="100%" -->
                <vbox id="leftPane"
                      height="100%"
                      classNames="hide-scrollbar"
                      spacing="false"
                      css="background-color: #ffffff; padding: 16px; box-sizing: border-box; overflow: hidden;">

                    <hbox css="align-items: center; flex-shrink: 0; margin-bottom: 8px;">
                        <icon icon="LIST" css="color: var(--lumo-secondary-text-color); width: 16px;"/>
                        <nativeLabel text="Danh sÃ¡ch trÆ°á»ng vÃ  giÃ¡ trá»‹" css="font-weight: 700; color: var(--lumo-header-text-color); font-size: 14px; text-transform: uppercase;"/>
                    </hbox>
                    <textField id="searchField"
                               placeholder="Search"
                               width="100%"
                               datatype="string"
                               css="margin-bottom: 12px; flex-shrink: 0;">
                        <prefix><icon icon="SEARCH" css="width: 16px; color: var(--lumo-tertiary-text-color);"/></prefix>
                    </textField>
                <vbox width="100%"
                      spacing="false"
                      css="flex-grow: 1; overflow-y: auto; gap: 0;"
                      classNames="hide-scrollbar">

                    <accordion>
                        <accordionPanel id="panel" summaryText="Metric "  classNames="font-bold text-l">
                            <vbox id="content">
                                <nativeLabel text="Metric" classNames="font-bold text-l" />
                            </vbox>
                        </accordionPanel>
                    </accordion>

                    <accordion>
                        <accordionPanel id="panel1" summaryText="Columns" classNames="text-l font-bold">
                            <vbox id="fieldsList"
                                  width="100%"
                                  height="100%"
                                  css="overflow-y: auto; gap: 8px; padding: 2px"
                                  classNames="hide-scrollbar"
                            />
                        </accordionPanel>
                    </accordion>
                    </vbox>
                </vbox>

                <!-- ðŸ”¸ Cá»˜T 2: Config -->
                <!-- ÄÃ£ xÃ³a width="100%", giá»¯ height="100%" -->
                <vbox id="middlePane"
                      height="100%"
                      spacing="false"
                      css="background-color: #ffffff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); padding: 20px; border: 1px solid rgba(0,0,0,0.05); margin-left: 6px; margin-right: 6px; box-sizing: border-box;">

                    <hbox css="align-items: center; gap: 8px; border-bottom: 1px solid var(--lumo-contrast-10pct); padding-bottom: 3px;">

                        <icon icon="COG" css="color: var(--lumo-secondary-text-color);"/>
                        <nativeLabel text="Cáº¥u hÃ¬nh trá»¥c" css="font-weight: 700; color: var(--lumo-header-text-color); font-size: 16px;"/>
                    </hbox>

                    <vbox id="configContainer" width="100%" spacing="false" padding="false" css=" flex-grow: 1; overflow-y: auto;">
                        <fragment id="barConfig"
                                  class="com.company.chartconfig.view.chartfragment.BarConfigFragment"/>
                        <fragment id="pieConfig"
                                  class="com.company.chartconfig.view.chartfragment.PieConfigFragment"/>
                        <fragment id="lineConfig"
                                  class="com.company.chartconfig.view.chartfragment.LineConfigFragment"/>
                    </vbox>

                    <vbox width="100%" css="gap: 10px; margin-top: auto; padding-top: 20px; border-top: 1px solid var(--lumo-contrast-10pct); flex-shrink: 0;">
                        <button id="previewBtn"
                                text="Xem trÆ°á»›c"
                                width="100%"
                                themeNames="primary outlined"
                                css="border-radius: 8px;"/>
                        <button id="closeBtn"
                                action="closeAction"
                                text="Há»§y bá»"
                                width="100%"
                                themeNames="tertiary error"
                                css="border-radius: 8px;"/>
                    </vbox>
                </vbox>
            </split>

            <!-- ðŸŸ§ VÃ™NG BÃŠN PHáº¢I: Preview -->
            <!-- ÄÃ£ xÃ³a width="100%", giá»¯ height="100%" -->
            <vbox id="rightPane"
                  height="100%"
                  spacing="false"
                  css="background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 24px; border: 1px solid rgba(0,0,0,0.05); margin-left: 6px; box-sizing: border-box;">

                <hbox css="justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <nativeLabel text="Biá»ƒu Ä‘á»“ hiá»ƒn thá»‹" css="font-weight: 700; color: var(--lumo-header-text-color); font-size: 18px;"/>
                    <span css="background: var(--lumo-contrast-5pct); padding: 4px 12px; border-radius: 20px; color: var(--lumo-secondary-text-color); font-size: 12px;">Live Preview</span>
                </hbox>

                <vbox id="chartContainer"
                      width="100%"
                      height="100%"
                      css="background-color: #fafafa; border-radius: 8px; border: 1px dashed #d0d0d0; justify-content: center; align-items: center; overflow: hidden;"/>
            </vbox>

        </split>
    </layout>
</view>